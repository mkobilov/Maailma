(window.webpackJsonp=window.webpackJsonp||[]).push([["CollectionCommentsPage~CommentsPage~Explore~Frontpage~GovernanceReleaseNotesModal~ModListing~ModQueu~4dc0ff37"],{"./src/reddit/components/Media/RichTextContainer/index.m.less":function(e,t,i){e.exports={richTextContainer:"Chtkt3BCZQruf0LtmFg2c",richTextContainerFull:"_3xX726aBn29LDbsDtzr_6E",placeholder:"_1aLU7RPNLdvfcbaNdcN11x",placeholderParagraph:"Owi9iYzjyVpDq_0YbCdJY"}},"./src/reddit/components/Media/index.m.less":function(e,t,i){e.exports={hiddenLink:"_3dhFVFchWAAFXfLFTa94n9",displayNone:"_1Q2mF3u7v9hBVu_4bkC7R4"}},"./src/reddit/components/Media/index.tsx":function(e,t,i){"use strict";var s,o=i("./node_modules/lodash/debounce.js"),n=i.n(o),a=i("./node_modules/react/index.js"),d=i.n(a),r=i("./bundled-modules/styled-components/styled-components.min.js"),c=i.n(r),l=i("./src/lib/env/index.ts"),h=i("./src/lib/isUrl/index.ts"),p=i("./node_modules/brcast/dist/brcast.es.js"),u=i("./node_modules/lodash/findKey.js"),m=i.n(u);!function(e){e.Hidden="hidden",e.Visible="visible"}(s||(s={}));const b={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};let g=!1;const f=Object(p.a)({documentInFocus:!0});!function(){if(!g){const e=m()(b,(e,t)=>void 0!==document[t]);e&&document.addEventListener(b[e],()=>{f.setState({documentInFocus:document.visibilityState!==s.Hidden})}),g=!0}}();var x={subscribe:e=>{return f.subscribe(e)},unsubscribe:e=>{f.unsubscribe(e)}},w=i("./src/lib/permalinkToOverlayLocation/index.ts"),v=i("./src/lib/raven/index.ts"),E=i("./src/reddit/components/HTML5StreamPlayer/index.tsx"),y=i("./src/reddit/components/Media/EmbedBox/index.tsx"),S=i("./src/reddit/components/Media/ImageBox/index.tsx"),C=i("./src/reddit/components/Media/MediaContainer/index.tsx"),O=i("./src/lib/classNames/index.ts"),M=i("./src/reddit/constants/componentSizes.ts"),I=i("./src/reddit/models/Media/index.ts"),L=i("./node_modules/react-redux/es/index.js"),j=i("./src/reddit/actions/post.ts"),T=i("./src/reddit/helpers/styles/mixins/loading.ts"),P=i("./src/reddit/components/Media/RichTextContainer/index.m.less"),F=i.n(P);const W=c.a.div.withConfig({componentId:"b1ntrq-0"})(["",""],T.c);var N=Object(L.b)(null,e=>({onLoadRichTextContentIfNeeded:t=>e(Object(j.p)(t))}))(class extends d.a.Component{componentDidMount(){this.loadRichTextContentIfNeeded()}loadRichTextContentIfNeeded(){this.props.canLoadContent&&this.props.isExpando&&this.props.onLoadRichTextContentIfNeeded(this.props.postId)}render(){return d.a.createElement("div",{className:F.a.placeholder},[1,2,3].map(e=>d.a.createElement("div",{key:e,className:F.a.placeholderParagraph},d.a.createElement(W,{isLoading:!0,gradientType:"posts"}),d.a.createElement(W,{isLoading:!0,gradientType:"posts"}),d.a.createElement(W,{isLoading:!0,gradientType:"posts"}))))}}),R=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&(i[s[o]]=e[s[o]])}return i};var D=e=>{var t=e.canLoadContent,i=e.children,s=e.className,o=e.isCommentsPage,n=e.isRichTextTruncated,a=e.isExpando,r=e.postId,c=e.showFull,l=R(e,["canLoadContent","children","className","isCommentsPage","isRichTextTruncated","isExpando","postId","showFull"]);const h=c?F.a.richTextContainerFull:F.a.richTextContainer,p={};c||(p.maxHeight=`${I.j}px`),o&&(p.maxWidth=`${M.g}px`);const u=n&&c;return d.a.createElement("div",Object.assign({className:Object(O.a)(h,s),style:p},l),i,u&&d.a.createElement(N,{canLoadContent:!!t,isExpando:a,postId:r}))},V=i("./src/reddit/components/Media/VideoBox/index.tsx"),B=i("./src/reddit/components/PlayButton/index.tsx"),H=i("./src/reddit/components/RawHTMLDisplay/index.tsx"),k=i("./src/reddit/components/RichTextJson/index.tsx"),A=i("./src/reddit/constants/screenWidths.ts"),U=i("./src/reddit/helpers/canPreviewSelfText/index.ts"),G=i("./src/reddit/helpers/getRichTextContent.ts"),_=i("./src/reddit/helpers/postHasSelfText/index.ts"),z=i("./src/lib/redditId/index.ts");function J(e,t){const i=function e(t,i){let s=!1;let o=[];try{for(const n of t)if("link"===n.e&&n.u&&n.u.includes(`https://www.reddit.com/poll/${i}`))s=!0;else if(n.c&&"string"!=typeof n.c){const t=e(n.c,i);t.found?(s=!0,("par"!==n.e||t.updated.length)&&o.push(Object.assign({},n,{c:t.updated}))):o.push(n)}else o.push(n)}catch(n){s=!1,o=[]}return{found:s,updated:s?o:t}}(e.document,Object(z.c)(t));return i.found?{document:i.updated}:e}const $=(e,t,i,s)=>{const o=e/t,n=i/s;return Math.abs(o-n)<.03},q=(e,t)=>{for(let i=0;i<t.length;i++){const s=t[i];if(s.width>=e)return s}},Q=(e,t,i)=>{for(let s=0;s<i.length;s++){const o=i[s];if(o.width>=I.e/2&&$(e,t,o.height,o.width))return o}},X=e=>{for(let t=0;t<e.length;t++){const i=e[t];if(i.height>=I.e||i.width>=I.f)return i}};var Y=i("./src/reddit/components/Media/index.m.less"),K=i.n(Y),Z=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],s=!0,o=!1,n=void 0;try{for(var a,d=e[Symbol.iterator]();!(s=(a=d.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(r){o=!0,n=r}finally{try{!s&&d.return&&d.return()}finally{if(o)throw n}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const ee=1200,te="https://www.redditmedia.com",ie=75,se="player.js",oe=M.F+M.E,ne=e=>e.isVisible?e.children:d.a.createElement("div",{className:K.a.displayNone},e.children),ae=new Set([I.m.EMBED,I.m.GIFVIDEO,I.m.VIDEO]),de=e=>!!e.media&&ae.has(e.media.type),re=new Set([I.m.EMBED,I.m.GIFVIDEO,I.m.IMAGE,I.m.VIDEO]),ce=e=>!!e.media&&re.has(e.media.type);t.a=Object(r.withTheme)(class extends d.a.Component{constructor(e){super(e),this.pauseContent=(()=>{this.shouldFocusContentDebouncer(!1)}),this.stopContent=(()=>{const e=this.props.post.media;if(e&&I.d.has(e.type)){if(this.iframe){const t=e.type===I.m.EMBED?e.provider:null;this.pauseEmbed(this.iframe,t)}this.setState(e=>e.shouldStop?null:{shouldStop:!0})}}),this.handleVisibilityChange=(e=>{const t=this.state.shouldPause,i=this.props.autoplayPref;this.iframe&&(t||!i&&e.documentInFocus||this.toggleEmbedAutoplay(this.iframe,!e.documentInFocus)),this.setState({forcePause:!e.documentInFocus})}),this.focusContent=(()=>{this.shouldFocusContentDebouncer(!0)}),this.loadContent=(()=>{this.setState(e=>e.canLoadContent?null:{canLoadContent:!0})}),this.unmountContent=(()=>{}),this.contentIsHeavyToMount=(()=>{const e=this.props.post.media;return!!e&&I.d.has(e.type)}),this.shouldFocusContentDebouncer=n()(e=>{const t=this.props.post.media,i=this.props.autoplayPref;if(t&&I.d.has(t.type)){if(this.iframe){const s=t.type===I.m.EMBED?t.provider:null;s&&!I.p.has(s)?!i&&e||this.toggleEmbedAutoplay(this.iframe,!e):e||this.pauseEmbed(this.iframe,s)}e?this.setState(e=>e.shouldPause||!e.canLoadContent?{canLoadContent:!0,shouldPause:!1,shouldStop:!1}:null):this.setState(e=>e.shouldPause?null:{shouldPause:!0})}},250,{leading:!0}),this.toggleEmbedAutoplay=((e,t)=>{if(e.contentWindow){const i=t?I.g.Pause:I.g.Play;e.contentWindow.postMessage({context:se,method:i},te),e.contentWindow.postMessage({context:se,method:I.g.Mute},te)}}),this.pauseEmbed=((e,t)=>{e.contentWindow&&(t===I.q.YouTube?e.contentWindow.postMessage(JSON.stringify({event:"command",func:I.u.Pause}),te):e.contentWindow.postMessage({context:se,method:I.g.Pause},te))}),this.onIframeLoaded=(()=>{const e=this.props.post.media,t=this.props.autoplayPref,i=e&&e.type===I.m.EMBED?e.provider:null;if(this.iframe&&i&&!I.p.has(i)){const e=this.state.shouldPause;(t||e)&&this.toggleEmbedAutoplay(this.iframe,e)}}),this.onImageBoxClick=(e=>{this.props.isListing||!this.shouldBlur()||this.state.isRevealed||(this.setState({isRevealed:!0}),e.preventDefault(),e.stopPropagation())}),this.storeChildRef=(e=>{this.iframe=e}),this.updateDimensions=(()=>{this.setState({viewportHeight:window.innerHeight,viewportWidth:window.innerWidth})}),this.isSpoiler=(()=>this.props.post.isSpoiler||!(!this.props.crosspost||!this.props.crosspost.isSpoiler)),this.isNSFW=(()=>this.props.post.isNSFW||!(!this.props.crosspost||!this.props.crosspost.isNSFW)),this.state={canLoadContent:e.shouldLoad||!1,forcePause:!1,isRevealed:!1,shouldPause:void 0===e.shouldPause||e.shouldPause,shouldStop:void 0===e.shouldStop||e.shouldStop,viewportHeight:I.e,viewportWidth:I.f}}componentWillMount(){"undefined"!=typeof window&&(this.updateDimensions(),window.addEventListener("resize",this.updateDimensions))}componentDidMount(){de(this.props.post)&&(this.visibilityChangeSubscriptionId=x.subscribe(e=>{this.handleVisibilityChange(e)})),this.props.scrollerItemRef&&ce(this.props.post)&&this.props.scrollerItemRef(this,this.state.canLoadContent)}componentWillUnmount(){this.visibilityChangeSubscriptionId&&x.unsubscribe(this.visibilityChangeSubscriptionId),this.props.scrollerItemRef&&ce(this.props.post)&&this.props.scrollerItemRef(void 0),window.removeEventListener("resize",this.updateDimensions)}componentWillReceiveProps(e){!this.state.canLoadContent&&e.shouldLoad&&this.setState({canLoadContent:!0}),void 0!==e.shouldPause&&e.shouldPause!==this.props.shouldPause&&this.shouldFocusContentDebouncer(!e.shouldPause)}getVideoExpandoMaxDimensions(){let e,t=Math.max(I.i,this.state.viewportHeight),i=Math.min(ee,16*t/9);i===ee&&(t=9*ee/16),e=this.state.viewportWidth>=A.g?this.state.viewportWidth<M.w?this.state.viewportWidth-oe-2*ie:this.state.viewportWidth-oe-M.i-2*ie:this.state.viewportWidth-2*ie;const s=this.state.viewportHeight-2*ie;if(i>e)t*=e/i,i=e;else if(t>s){const e=s/t;t=s,i*=e}return{maxVideoHeight:t,maxVideoWidth:i}}getMediaInfo(e){const t=e.availableWidth,i=e.post,s=i.media&&i.media.obfuscated||"";let o=i.media&&!Object(I.B)(i.media)?i.media.content:"";var n=!i.media||Object(I.z)(i.media)||Object(I.A)(i.media)?[0,0]:[i.media.height,i.media.width],a=Z(n,2);let d=a[0],r=a[1];if(t&&i.media&&(i.media.type===I.m.IMAGE||i.media.type===I.m.GIFVIDEO)){const e=q(t,i.media.resolutions);e&&(o=e.url,r=e.width,d=e.height)}else if(i&&i.media&&(!e.isListing||e.isExpando)&&(i.media.type===I.m.IMAGE||i.media.type===I.m.GIFVIDEO)){let e;(e=Object(S.b)(i.media.height,i.media.width)&&Object(S.c)(i.media.height)?Q(i.media.height,i.media.width,i.media.resolutions):X(i.media.resolutions))&&(o=e.url,r=e.width,d=e.height)}if(e.isExpando)if(r>this.state.viewportWidth)d*=this.state.viewportWidth/r,r=this.state.viewportWidth;else if(d>this.state.viewportHeight){const e=this.state.viewportHeight/d;d=this.state.viewportHeight,r*=e}var c=this.getVideoExpandoMaxDimensions();const l=c.maxVideoHeight,h=c.maxVideoWidth;if(i.media&&i.media.type===I.m.VIDEO){const t=d/r;t>I.c?(d=I.k,r=Math.min(Math.max(I.k/t,I.o),I.l)):(d=Math.min(Math.max(I.l*t,I.n),I.k),r=I.l),e.isExpando&&(d=l,r=h)}i.media&&i.media.type===I.m.EMBED&&e.isExpando&&(d=l,r=h);let p=!1;if(e.isMiniCard){const e=d/r;p=Math.abs(e-I.c)>.01}return{source:o,obfuscated:s,width:r,height:d,needsBackgroundBlur:p}}shouldBlur(){var e=this.props;const t=e.isCommentsPage,i=e.isExpando,s=e.isListing,o=e.isOverlay,n=e.theme,a=this.isNSFW(),d=this.isSpoiler();return!(!a||!s||i||n.subredditContext.shouldShowNSFWContent)||!(!d||!(s||t&&!o)||i||this.state.isRevealed)}render(){var e=this.props;const t=e.className,i=e.crosspost,s=e.flairStyleTemplate,o=e.forceAspectRatio,n=e.isCommentsPage,a=e.isExpando,r=e.isListing,c=e.isNotCardView,p=e.post,u=e.showCentered;var m=e.showFull;const b=void 0!==m&&m;var g=this.state;const f=g.canLoadContent,x=g.forcePause,O=g.shouldPause,M=g.shouldStop;if(!p.media)return null;const L=x||O,j=M;var T=this.getMediaInfo(this.props);const P=T.source,F=T.obfuscated,W=T.height,N=T.width,R=T.needsBackgroundBlur,A={showCentered:u,isListing:r,showFull:b,height:W,width:N},$=Object.assign({},A,{forceAspectRatio:o,className:t}),q=this.shouldBlur(),Q=!(!p.isSponsored||!p.source);if(F&&q)return d.a.createElement(C.a,Object.assign({},$,{blurSrc:F}),d.a.createElement(ne,{isVisible:f},d.a.createElement(S.a,Object.assign({},A,{isListing:r,isNSFW:this.isNSFW(),isSpoiler:this.isSpoiler(),isVideoThumbnail:p.media.type===I.m.VIDEO,onClick:this.onImageBoxClick,postId:p.id,shouldBlur:q,source:F,outboundUrl:Q&&p.source.outboundUrl||void 0,originalSource:P}))));switch(p.media.type){case I.m.RTJSON:const e=Object(G.a)(p,null);if(null===e)return;return b||Object(U.a)(p)?d.a.createElement(D,{canLoadContent:f,className:t,"data-click-id":"text",isCommentsPage:n,isExpando:a,isRichTextTruncated:p.media.isRichtextPreview,postId:p.id,showFull:b},d.a.createElement(k.b,{flairStyleTemplate:s,content:p.isMeta?J(e,p.id):e,mediaMetadata:p.media.mediaMetadata,renderingObjectInfo:p,renderMediaAsLinks:r})):null;case I.m.TEXT:if(Object(_.a)(p)){const e="Text post should not include body content";return Object(v.c)(e,{extra:{info:{post:p,isListing:r,isCommentsPage:n}}}),Object(l.a)()&&console.log(`${p.id}: ${e}`),d.a.createElement(D,{postId:p.id,className:t,"data-click-id":"text",isCommentsPage:n,showFull:b},d.a.createElement(H.a,{flairStyleTemplate:s,html:p.isMeta?function(e,t,i){return e.replace(`href="https://www.reddit.com/poll/${Object(z.c)(t)}`,`class="${i}" href="https://www.reddit.com/poll/${Object(z.c)(t)}`)}(p.media.content,p.id,K.a.hiddenLink):p.media.content}))}return null;case I.m.EMBED:return this.props.isMiniCard&&p.preview&&p.preview.url?d.a.createElement(C.a,Object.assign({},$,{alwaysWrapMedia:!0}),d.a.createElement(ne,{isVisible:f},d.a.createElement(d.a.Fragment,null,d.a.createElement(S.a,Object.assign({},A,{isExpando:a,isListing:r,isNSFW:this.isNSFW(),isCrosspost:!!i,isSpoiler:this.isSpoiler(),postId:p.id,shouldBlur:q,source:p.preview.url,originalSource:p.preview.url})),d.a.createElement(B.b,null)))):I.h.has(p.media.provider)?d.a.createElement(C.a,Object.assign({},$,{alwaysWrapMedia:!0,height:a?W:I.i,width:a?N:I.i*(16/9)}),f&&d.a.createElement(y.a,{childRef:this.storeChildRef,height:a?W:I.i,width:a?N:void 0,isListing:r,isResponsive:!0,onLoad:this.onIframeLoaded,showCentered:u,showFull:b,source:P,title:p.title})):d.a.createElement(C.a,Object.assign({},$,{alwaysWrapMedia:!0}),f&&d.a.createElement(y.a,Object.assign({},A,{isResponsive:a||p.media.provider===I.q.IFrameEmbed,title:p.title,childRef:this.storeChildRef,onLoad:this.onIframeLoaded,source:P,fullWidth:p.media.provider===I.q.IFrameEmbed})));case I.m.GIFVIDEO:{let e=W,t=N;return e>I.i&&(t=N/W*(e=I.i)),d.a.createElement(C.a,Object.assign({},$,{blurSrc:R?p.media.gifBackgroundImage:void 0}),d.a.createElement(ne,{isVisible:f},d.a.createElement(V.a,Object.assign({},A,{isNotCardView:c,height:a?void 0:e,width:a?void 0:t,postId:p.id,shouldLoad:!0,shouldPause:L,source:P,originalSource:p.media.content}))))}case I.m.VIDEO:{const e=p.media.posterUrl||p.preview&&p.preview.url;return this.props.isMiniCard&&e?d.a.createElement(C.a,Object.assign({},$,{alwaysWrapMedia:!0}),d.a.createElement(ne,{isVisible:f},d.a.createElement(d.a.Fragment,null,d.a.createElement(S.a,Object.assign({},A,{isExpando:a,isListing:r,isNSFW:this.isNSFW(),isCrosspost:!!i,isSpoiler:this.isSpoiler(),postId:p.id,shouldBlur:q,source:e,originalSource:e})),d.a.createElement(B.b,null)))):d.a.createElement(C.a,Object.assign({},$,{alwaysWrapMedia:!0}),f&&d.a.createElement(E.b,{autoPlay:"boolean"==typeof O?!O:void 0,isExpando:a,postUrl:Object(w.a)(p.permalink),shouldLoad:!0,shouldPause:L,shouldStop:j,hlsSource:p.media.hlsUrl,mpegDashSource:p.media.dashUrl,isGif:p.media.isGif,scrubberThumbSource:p.media.scrubberThumbSource,postId:p.id,callToActionSource:p.source||void 0,callToActionText:p.callToAction,isListing:r,posterUrl:p.media.posterUrl}))}case I.m.IMAGE:const o=this.state.viewportHeight-2*ie,m=this.state.viewportWidth-2*ie;let g=P;return this.props.isMiniCard&&!this.props.isMiniCardHQPreviews&&(p.thumbnail&&Object(h.a)(p.thumbnail.url)?g=p.thumbnail.url:p.preview&&Object(h.a)(p.preview.url)&&(g=p.preview.url)),d.a.createElement(C.a,Object.assign({},$,{blurSrc:R?g:void 0,isExpando:!!a}),d.a.createElement(ne,{isVisible:f},d.a.createElement(S.a,Object.assign({},A,{isExpando:a,isListing:r,isNSFW:this.isNSFW(),isCrosspost:!!i,isSpoiler:this.isSpoiler(),maxHeight:a?o:void 0,maxWidth:a?m:void 0,postId:p.id,shouldBlur:q,source:g,outboundUrl:Q&&p.source.outboundUrl||void 0,originalSource:p.media.content}))));default:return null}}})},"./src/reddit/helpers/canPreviewSelfText/index.ts":function(e,t,i){"use strict";var s=i("./src/reddit/helpers/postHasSelfText/index.ts");t.a=(e=>Object(s.a)(e)&&!e.isSpoiler&&!e.isNSFW)},"./src/reddit/helpers/postHasSelfText/index.ts":function(e,t,i){"use strict";var s=i("./src/reddit/models/Media/index.ts"),o=i("./src/reddit/models/RichTextJson/index.ts");t.a=(e=>{const t=e&&e.media;return!!t&&(t.type===s.m.TEXT&&!!t.content||t.type===s.m.RTJSON&&!Object(o.E)(t.richtextContent))})}}]);
//# sourceMappingURL=CollectionCommentsPage~CommentsPage~Explore~Frontpage~GovernanceReleaseNotesModal~ModListing~ModQueu~4dc0ff37.e14cb4cfda0ec64fe655.js.map